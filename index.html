<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>正在返回 App…</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#1a1d24;color:#e0e0e0;
       display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;padding:24px;text-align:center}
  .btn{display:inline-block;padding:12px 18px;border-radius:10px;background:#f35a69;color:#fff;text-decoration:none;font-size:16px}
  .tip{color:#a0a0a0;margin-top:12px;max-width:520px}
  .code{word-break:break-all;color:#a0a0a0;font-size:12px;margin-top:8px}
</style>
<h2>授权成功，正在返回 App…</h2>
<a id="openApp" class="btn" href="#">立即返回 App</a>
<div class="tip">若未自动跳转，请点击上方按钮。</div>
<div id="dbg" class="code"></div>
<script>
  const sp=new URLSearchParams(location.search);
  const code=sp.get('code')||'', state=sp.get('state')||'';
  const scheme=`gemoji://oauth/callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}`;
  const intent=`intent://oauth/callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}#Intent;scheme=gemoji;package=god.of.meme;end`;
  document.getElementById('openApp').href=scheme;
  document.getElementById('openApp').addEventListener('click', () => {
    // 用户手势触发：先走 scheme，不行再走 intent
    location.href = scheme;
    setTimeout(()=>{ if(/Android/i.test(navigator.userAgent)) location.href = intent; }, 200);
  });
  // 自动尝试一遍（部分浏览器允许）
  (function autoTry(){
    try { history.replaceState(null,'',location.pathname); } catch(e){}
    location.href = scheme;
    setTimeout(()=>{ if(/Android/i.test(navigator.userAgent)) location.href = intent; }, 400);
  })();
  // 调试信息（可保留）
  document.getElementById('dbg').textContent = `code=${code} state=${state}`;
</script>

<!doctype html>
<meta charset="utf-8">
<title>Coze OAuth Callback</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:24px;margin:0;color:#e0e0e0;background:#1a1d24}
  .btn{display:inline-block;padding:10px 16px;border-radius:8px;background:#f35a69;color:#fff;text-decoration:none}
  .tip{color:#a0a0a0;margin-top:12px}
</style>
<h3>正在跳回 App，请稍候…</h3>
<a id="openApp" class="btn" href="#">手动返回 App</a>
<div class="tip">若长时间无响应，请点击上方按钮。</div>
<script>
  const sp=new URLSearchParams(location.search);
  const code=sp.get('code')||'', state=sp.get('state')||'';
  const scheme=`gemoji://oauth/callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}`;
  const pkg='god.of.meme';
  const intent=`intent://oauth/callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}#Intent;scheme=gemoji;package=${pkg};end`;
  document.getElementById('openApp').href=scheme;
  function openApp(){
    location.href=scheme; // 先尝试自定义 Scheme
    setTimeout(()=>{ if(/Android/i.test(navigator.userAgent)) location.href=intent; }, 800); // Android 兜底
  }
  openApp();
</script>

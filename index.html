<!doctype html>
<meta charset="utf-8">
<title>Coze OAuth Callback</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:24px}
  .btn{display:inline-block;padding:10px 16px;border-radius:8px;background:#f35a69;color:#fff;text-decoration:none}
  .tip{color:#666;margin-top:12px}
</style>
<div>正在跳回 App，请稍候…</div>
<a id="openApp" class="btn" href="#">手动返回 App</a>
<div class="tip">若长时间无响应，请点击上方按钮。</div>
<script>
  function q(n){return new URLSearchParams(location.search).get(n)}
  const code=q('code'); const state=q('state')||'';
  const schemeUrl=`gemoji://oauth/callback?code=${encodeURIComponent(code||'')}&state=${encodeURIComponent(state)}`;
  const openBtn=document.getElementById('openApp');
  openBtn.href=schemeUrl;

  // Android intent 兜底（可选）：把 YOUR_PACKAGE 替换为你的应用包名
  const pkg='梗表情之神';
  const intentUrl=`intent://oauth/callback?code=${encodeURIComponent(code||'')}&state=${encodeURIComponent(state)}#Intent;scheme=gemoji;package=${pkg};end`;

  function tryOpen(){
    // 先尝试自定义 Scheme
    location.href=schemeUrl;
    // 800ms 后再尝试 intent 兜底（Android）
    setTimeout(()=>{ if (/Android/i.test(navigator.userAgent)) location.href=intentUrl; }, 800);
  }

  // 自动尝试打开 App；失败时用户可点按钮
  tryOpen();
</script>